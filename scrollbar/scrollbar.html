<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>自定义滚动条</title>
    <link rel="stylesheet" type="text/css" href="http://cdn.bootcss.com/normalize/3.0.3/normalize.min.css">
    <style type="text/css">
        * {
            box-sizing: border-box;
        }
        #main {
            position: relative;
            width: 300px;
            border-radius: 8px;
            height: 400px;
            margin: 50px auto 0;
            overflow: hidden;
        }
        #content {
            position: absolute;
            width: 280px;
            padding: 7px;
            background: #EDEDED;
        }
        #aside {
            position: absolute;
            right: 0;
            width: 20px;
            height: 400px;
            background: #8C8C8C;
        }
        #bar {
            position: absolute;
            width: 20px;
            border-radius: 8px;
            background: #555;
        }
    </style>
</head>
<body>
    <div id="main">
        <div id="content">
            哥白尼不认同托勒密的体系，一个极其重要的原因是，他觉得托勒密提出的偏心等距点毫无美感…… ---托马斯·库恩，《哥白尼革命》
            我们所有人都会受到凯利·约翰逊的影响，狂热地相信外观优美的飞机一定会飞得同样漂亮。  ---本·里奇，《臭鼬计划》
            美感是第一道关卡。丑陋的数学在世界上无法生存。 ---G.H.哈代，《一个数学家的道歉》
            众多学科对“美”的认识有着惊人的相似度。
            好设计是简单的设计。（当你被迫把东西做得很简单时，你就被迫直接面对真正的问题。当你不能用表面装饰交差时，你就不得不做好真正的本质部分。）
            好设计是永不过时的设计。(如果你希望自己的作品对未来的人们有吸引力，方法之一就是让你的作品对上几代人有吸引力。）
            好的设计是解决主要问题的设计。（软件的难题通常可以被改成等价的较易解决的形式）
            好设计是启发性的设计。（为用户提供基本模块，使得他们可以所心所欲自由组合。可参考《Unix编程艺术》）
            好设计通常有点趣味性的设计。（幽默感是强壮的一种表现。）
            好设计是艰苦的设计。（野生动物非常优美，原因就在于它们的生活非常艰苦，在外形上不可能有多余的部分了。）
            好设计是看似容易的设计。（科学和工程学的一些最重大的发现在形式上往往很简单，会使得你觉得自己也想到过。）（重复练习的作用一般是把刻意为之的事情变成一种自觉的行为。）
            好设计是对称的设计。（自然界的对称大量存在，这就说明了对称的重要性。两种对称：重复性对称和递归性对称。叶子的叶脉纹路就是重复性对称。埃菲尔铁塔就是递归性对称，即大塔上面有小塔。）
            好设计是模仿大自然的设计。（大自然在长期的演化中已经解决了很多设计问题。如果你的设计与大自然很接近，那么它基本上不会很差。）
            好设计是一种再设计。（很少有人一次就把事情做对，先完成一个早期原型，然后再提出修改计划，最后把早期原型扔掉。）
            好设计是能够复制的设计。（不知不觉的模仿几乎必然导致坏设计。等你逐渐对一件事产生热情的时候，就不会满足于模仿了，开始自觉地进行原创。）
            好设计常常是奇特的设计。（爱因斯坦并不想让相对论变得很奇特，他只想找出真理，是真理本身显得很奇特。）
            好设计是成批出现的。（推动人才成批涌现的最大因素就是，让有天赋的人聚在一起，共同解决某个难题。）
            好设计常常是大胆的设计。
            ---《黑客与画家》
        </div>
        <div id="aside">
            <div id="bar"></div>
        </div>
    </div>
    <script type="text/javascript">
        (function() {
            function ScrollBar(opts) {
                this.main = document.getElementById(opts.mainId);
                this.content = document.getElementById(opts.contentId);
                this.aside = document.getElementById(opts.asideId);
                this.bar = document.getElementById(opts.barId);
                this.init();
            }

            ScrollBar.prototype = {
                init: function() {
                    // 根据显示区与总内容区高度比例 初始化滚动条高度
                    this.bar.style.height = this.aside.offsetHeight * (this.main.offsetHeight / this.content.offsetHeight) + 'px';
                    this.bar.onmousedown = this._handleMousedown.bind(this);
                    // firefox浏览器事件名与其他浏览器不同
                    if ((navigator.userAgent.toLowerCase().indexOf('firefox') !== -1)) {
                        this.main.addEventListener('DOMMouseScroll', this._handleScroll.bind(this), false);
                    } else if (this.main.addEventListener) {
                        this.main.addEventListener('mousewheel', this._handleScroll.bind(this), false);
                    } else if (this.main.attachEvent) {
                        this.main.attachEvent('onmousewheel', this._handleScroll.bind(this));
                    } else {
                        this.main.onmousewheel = this._handleScroll.bind(this);
                    }
                },

                // 设置滚动条位置和内容区位置
                setPos: function(relativeY) {
                    // 防止滚动条向上超过侧边区
                    if (relativeY < 0) {
                        relativeY = 0;
                    // 防止滚动条向下超过侧边区
                    } else if (relativeY > this.aside.offsetHeight - this.bar.offsetHeight) {
                        relativeY = this.aside.offsetHeight - this.bar.offsetHeight;
                    }
                    // 设置滚动条位置
                    this.bar.style.top = relativeY + 'px';
                    // 设置内容区位置
                    var scale = relativeY / (this.aside.offsetHeight - this.bar.offsetHeight);
                    this.content.style.top = -scale * (this.content.offsetHeight - this.main.offsetHeight) + 'px';
                },

                // 为滚动条注册鼠标按下事件
                _handleMousedown: function(ev) {
                    var self = this;
                    var oEvent = ev || event;
                    var disY = oEvent.clientY - this.bar.offsetTop;
                    // 为滚动条注册鼠标移动事件
                    document.onmousemove = function(ev) {
                        var oEvent = ev || event;
                        // 计算鼠标移动时，滚动条顶部相对侧边区顶部的距离
                        var relativeY = oEvent.clientY - disY;
                        // 设置滚动条位置和内容区位置
                        self.setPos(relativeY);
                    }
                    // 为滚动条注册鼠标松开事件
                    document.onmouseup = function() {
                        // 解除事件绑定
                        document.onmousemove = null;
                        document.onmouseup = null;
                    }
                    // 终止事件
                    return false;
                },

                _handleScroll: function(ev) {
                    var oEvent = ev || event;
                    // firefox中方向判断与其他浏览器相反
                    var delta = oEvent.detail || (-oEvent.wheelDelta);
                    var relativeY = this.bar.offsetTop;
                    if (delta > 0) {
                        relativeY += 10;
                    } else {
                        relativeY -= 10;
                    }
                    this.setPos(relativeY);
                    return false;
                },

                destroy: function() {
                    this.aside.parentNode.removeChild(this.aside);
                    if ((navigator.userAgent.toLowerCase().indexOf('firefox') !== -1)) {
                        this.main.removeEventListener('DOMMouseScroll', this._handleScroll.bind(this), false);
                    } else if (this.main.removeEventListener) {
                        this.main.removeEventListener('mousewheel', this._handleScroll.bind(this), false);
                    } else if (this.main.detachEvent) {
                        this.main.detachEvent('onmousewheel', this._handleScroll.bind(this));
                    } else {
                        this.main.onmousewheel = null;
                    }
                }
            };

            var options = {
                mainId: 'main',
                contentId: 'content',
                asideId: 'aside',
                barId: 'bar'
            };

            var scrollBar = new ScrollBar(options);
            // scrollBar.destroy();
        })();
    </script>
</body>
</html>